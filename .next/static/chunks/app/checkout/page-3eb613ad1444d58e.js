(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{1083:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(5155),s=r(2115),o=r(5695),n=r(9576);let l=e=>t=>{let r=(0,o.useRouter)(),{isAuthenticated:l}=(0,n.A)();return((0,s.useEffect)(()=>{l||r.replace("/login")},[l,r]),l)?(0,a.jsx)(e,{...t}):null}},3006:(e,t,r)=>{Promise.resolve().then(r.bind(r,9301))},5505:(e,t,r)=>{"use strict";r.d(t,{U:()=>s});var a=r(2115);let s=()=>{let[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(null);return{initiatePayment:async e=>{try{throw t(!0),s(null),Error("Razorpay not configured. Please check your environment variables.")}catch(e){throw t(!1),s(e instanceof Error?e.message:"Payment failed"),e}},isLoading:e,error:r}}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},6213:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>n,_:()=>l});var a=r(5155),s=r(2115);let o=(0,s.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,s.useState)([]),[l,d]=(0,s.useState)(!1),[i,c]=(0,s.useState)(0);(0,s.useEffect)(()=>{let e=localStorage.getItem("sonnas-cart");if(e){let t=JSON.parse(e).items||[];n(t),c(u(t))}},[]),(0,s.useEffect)(()=>{let e=()=>{n([]),d(!1),c(0)};return window.addEventListener("auth-logout",e),()=>{window.removeEventListener("auth-logout",e)}},[]),(0,s.useEffect)(()=>{localStorage.setItem("sonnas-cart",JSON.stringify({items:r})),c(u(r))},[r]);let u=e=>e.reduce((e,t)=>e+t.price*t.quantity,0),m=e=>{n(t=>t.filter(t=>t.id!==e))};return(0,a.jsx)(o.Provider,{value:{items:r,isOpen:l,total:i,addToCart:e=>{n(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}]),d(!0)},removeFromCart:m,updateQuantity:(e,t)=>{if(t<=0)return void m(e);n(r=>r.map(r=>r.id===e?{...r,quantity:t}:r))},toggleCart:()=>{d(e=>!e)},clearCart:()=>{n([])}},children:t})}function l(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},9301:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(5155),s=r(2115),o=r(5695),n=r(6213),l=r(1083),d=r(5505);let i=(0,l.A)(function(){let{items:e,total:t,clearCart:r}=(0,n._)(),l=(0,o.useRouter)(),{initiatePayment:i,isLoading:c}=(0,d.U)(),[u,m]=(0,s.useState)({fullName:"",phone:"",address:"",city:"",pincode:"",landmark:""}),[h,b]=(0,s.useState)("cod"),[x,p]=(0,s.useState)(""),[y,f]=(0,s.useState)(!1),[w,g]=(0,s.useState)(null),v=t+50,j=(e,t)=>{m(r=>({...r,[e]:t}))},N=async()=>{if(u.fullName&&u.phone&&u.address&&u.city&&u.pincode?"upi"!==h||!!x||(g("Please enter your UPI ID"),!1):(g("Please fill all required address fields"),!1)){f(!0),g(null);try{if("online"===h){let a=await i({amount:v,customerInfo:{name:u.fullName,email:"",contact:u.phone}}),s={items:e,deliveryAddress:u,paymentMethod:"online",paymentId:a.paymentId,razorpayOrderId:a.orderId,total:t,deliveryFee:50,finalTotal:v,orderDate:new Date().toISOString()},o=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to place order")}let n=await o.json();r(),l.push("/order-success?orderId=".concat(n.orderId))}else{let a={items:e,deliveryAddress:u,paymentMethod:h,upiId:"upi"===h?x:null,total:t,deliveryFee:50,finalTotal:v,orderDate:new Date().toISOString()},s=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to place order")}let o=await s.json();r(),l.push("/order-success?orderId=".concat(o.orderId))}}catch(e){g(e.message)}finally{f(!1)}}};return 0===e.length?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-brown-900 via-brown-800 to-brown-900 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-display font-bold text-white mb-4",children:"Your cart is empty"}),(0,a.jsx)("p",{className:"text-brown-200 mb-8",children:"Add some delicious items to proceed with checkout"}),(0,a.jsx)("button",{onClick:()=>l.push("/menu"),className:"bg-amber-600 hover:bg-amber-700 text-white px-8 py-3 rounded-lg font-semibold",children:"Browse Menu"})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-brown-900 via-brown-800 to-brown-900 py-8 px-4",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-4xl font-display font-bold text-white text-center mb-8",children:"Checkout"}),(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-brown-800 bg-opacity-30 backdrop-blur-sm rounded-2xl p-6 border border-amber-300 border-opacity-20",children:[(0,a.jsx)("h2",{className:"text-2xl font-display font-bold text-white mb-6",children:"Order Summary"}),(0,a.jsx)("div",{className:"space-y-4 mb-6",children:e.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-brown-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-white font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-brown-300 text-sm",children:["Qty: ",e.quantity]})]}),(0,a.jsxs)("span",{className:"text-amber-300 font-semibold",children:["₹",(e.price*e.quantity).toFixed(2)]})]},e.id))}),(0,a.jsxs)("div",{className:"space-y-2 pt-4 border-t border-brown-700",children:[(0,a.jsxs)("div",{className:"flex justify-between text-brown-200",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{children:["₹",t.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-brown-200",children:[(0,a.jsx)("span",{children:"Delivery Fee:"}),(0,a.jsxs)("span",{children:["₹","50.00"]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-xl font-bold text-amber-300 pt-2 border-t border-brown-600",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["₹",v.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-brown-800 bg-opacity-30 backdrop-blur-sm rounded-2xl p-6 border border-amber-300 border-opacity-20",children:[(0,a.jsx)("h2",{className:"text-2xl font-display font-bold text-white mb-6",children:"Delivery Address"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Full Name *",value:u.fullName,onChange:e=>j("fullName",e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400",required:!0}),(0,a.jsx)("input",{type:"tel",placeholder:"Phone Number *",value:u.phone,onChange:e=>j("phone",e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400",required:!0})]}),(0,a.jsx)("textarea",{placeholder:"Complete Address *",value:u.address,onChange:e=>j("address",e.target.value),rows:3,className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400",required:!0}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"City *",value:u.city,onChange:e=>j("city",e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400",required:!0}),(0,a.jsx)("input",{type:"text",placeholder:"Pincode *",value:u.pincode,onChange:e=>j("pincode",e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400",required:!0})]}),(0,a.jsx)("input",{type:"text",placeholder:"Landmark (Optional)",value:u.landmark,onChange:e=>j("landmark",e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400"})]})]}),(0,a.jsxs)("div",{className:"bg-brown-800 bg-opacity-30 backdrop-blur-sm rounded-2xl p-6 border border-amber-300 border-opacity-20",children:[(0,a.jsx)("h2",{className:"text-2xl font-display font-bold text-white mb-6",children:"Payment Method"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===h,onChange:e=>b(e.target.value),className:"w-4 h-4 text-amber-600"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"Cash on Delivery"}),(0,a.jsx)("div",{className:"text-brown-300 text-sm",children:"Pay when your order arrives"})]})]})]}),(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"paymentMethod",value:"upi",checked:"upi"===h,onChange:e=>b(e.target.value),className:"w-4 h-4 text-amber-600"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCF1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"UPI Payment"}),(0,a.jsx)("div",{className:"text-brown-300 text-sm",children:"Pay using UPI ID"})]})]})]}),"upi"===h&&(0,a.jsx)("input",{type:"text",placeholder:"Enter your UPI ID (e.g., yourname@paytm)",value:x,onChange:e=>p(e.target.value),className:"w-full bg-brown-700 bg-opacity-50 border border-brown-600 rounded-lg px-4 py-3 text-white placeholder-brown-300 focus:outline-none focus:border-amber-400 ml-7"}),(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"paymentMethod",value:"online",checked:"online"===h,onChange:e=>b(e.target.value),className:"w-4 h-4 text-amber-600"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"text-2xl",children:"\uD83D\uDCB3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-white font-medium",children:"Online Payment"}),(0,a.jsx)("div",{className:"text-brown-300 text-sm",children:"Pay securely with Card/UPI/Wallet via Razorpay"})]})]})]})]})]}),w&&(0,a.jsx)("div",{className:"bg-red-500 bg-opacity-20 border border-red-500 border-opacity-30 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-red-300 text-center",children:w})}),(0,a.jsx)("button",{onClick:N,disabled:y||c,className:"w-full bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white font-semibold py-4 rounded-lg transition-all duration-300 shadow-xl hover:shadow-amber-500/25 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:y||c?"online"===h?"Processing Payment...":"Placing Order...":"Place Order - ₹".concat(v.toFixed(2))})]})]})]})})})},9576:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>l});var a=r(5155),s=r(2115);let o=(0,s.createContext)(void 0);function n(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[r,n]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{localStorage.getItem("authToken")&&n(!0)},[]),(0,a.jsx)(o.Provider,{value:{isAuthenticated:r,login:e=>{localStorage.setItem("authToken",e),n(!0)},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("sonnas-cart"),n(!1),window.dispatchEvent(new CustomEvent("auth-logout"))}},children:t})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=3006)),_N_E=e.O()}]);